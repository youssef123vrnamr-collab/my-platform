<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙÙ„Ùƒ Ø§Ù„Ø°ÙƒÙŠ | Ù…Ù†ØµØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª + AI</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Cairo', sans-serif; 
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 100%); 
            color: #fff; 
            min-height: 100vh;
        }
        
        /* Loading Screen */
        .loading { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: #0f0f23; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            z-index: 9999; 
            transition: opacity 0.5s;
        }
        .loading.hidden { opacity: 0; pointer-events: none; }
        .spinner { 
            width: 60px; 
            height: 60px; 
            border: 4px solid #333; 
            border-top-color: #e94560; 
            border-radius: 50%; 
            animation: spin 1s linear infinite; 
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Navbar */
        .navbar { 
            background: rgba(26, 26, 46, 0.95); 
            padding: 1rem 2rem; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border-bottom: 2px solid #e94560; 
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        .logo { 
            font-size: 1.8rem; 
            font-weight: bold; 
            color: #ffd700; 
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn { 
            padding: 0.8rem 1.5rem; 
            border: none; 
            border-radius: 25px; 
            cursor: pointer; 
            font-weight: bold; 
            background: #e94560; 
            color: white;
            transition: all 0.3s;
            font-family: 'Cairo', sans-serif;
        }
        .btn:hover { transform: scale(1.05); box-shadow: 0 5px 20px rgba(233, 69, 96, 0.4); }
        .btn-secondary { background: #8b5cf6; }
        .btn-success { background: #10b981; }
        .btn-danger { background: #dc2626; }
        
        .container { max-width: 1400px; margin: 0 auto; padding: 2rem; }
        
        /* Hero Section */
        .hero {
            text-align: center; 
            margin: 2rem 0;
            padding: 2rem;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(233, 69, 96, 0.1) 100%);
            border-radius: 20px;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }
        .hero h1 { color: #ffd700; font-size: 2.5rem; margin-bottom: 0.5rem; }
        .hero p { color: #888; }
        
        /* Admin Panel */
        .admin-panel { 
            background: linear-gradient(135deg, #16213e 0%, #1a1a3e 100%); 
            border: 2px dashed #8b5cf6; 
            border-radius: 20px; 
            padding: 2rem; 
            margin: 2rem 0; 
            text-align: center; 
            display: none;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .admin-panel.active { display: block; animation: slideDown 0.3s ease; }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Videos Grid */
        .videos-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); 
            gap: 2rem; 
            margin-top: 2rem; 
        }
        
        .video-card { 
            background: linear-gradient(135deg, #16213e 0%, #1a1a3e 100%); 
            border-radius: 20px; 
            overflow: hidden; 
            cursor: pointer; 
            transition: all 0.3s;
            border: 1px solid rgba(139, 92, 246, 0.2);
            position: relative;
        }
        .video-card:hover { 
            transform: translateY(-10px); 
            box-shadow: 0 20px 40px rgba(139, 92, 246, 0.3);
            border-color: #8b5cf6;
        }
        
        .video-thumb { 
            height: 200px; 
            background: linear-gradient(135deg, #0f3460 0%, #16213e 100%); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 3rem; 
            color: #8b5cf6; 
            position: relative;
            overflow: hidden;
        }
        .video-thumb img, .video-thumb video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .play-icon { 
            position: absolute; 
            width: 70px; 
            height: 70px; 
            background: linear-gradient(135deg, #8b5cf6 0%, #e94560 100%); 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: transform 0.3s;
        }
        .video-card:hover .play-icon { transform: scale(1.1); }
        
        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #dc2626;
            border: none;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            transition: transform 0.3s;
        }
        .delete-btn:hover { transform: scale(1.1); background: #ef4444; }
        
        .video-info { padding: 1.5rem; }
        .video-info h3 { color: #ffd700; margin-bottom: 0.5rem; font-size: 1.2rem; }
        .video-info p { color: #888; font-size: 0.9rem; }
        .video-size { 
            display: inline-block;
            background: rgba(139, 92, 246, 0.2);
            color: #8b5cf6;
            padding: 0.2rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-top: 0.5rem;
        }
        
        /* AI Chat Section */
        .ai-section {
            background: linear-gradient(135deg, #16213e 0%, #1a1a3e 100%);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
            border: 2px solid #10b981;
            display: none;
        }
        .ai-section.active { display: block; animation: slideDown 0.3s ease; }
        
        .chat-container {
            background: #0f0f23;
            border-radius: 15px;
            height: 400px;
            overflow-y: auto;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid #333;
        }
        .chat-message {
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: 15px;
            max-width: 80%;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .chat-message.user {
            background: linear-gradient(135deg, #e94560 0%, #8b5cf6 100%);
            margin-left: auto;
            text-align: right;
        }
        .chat-message.ai {
            background: #1a1a2e;
            border: 1px solid #8b5cf6;
            margin-right: auto;
        }
        .chat-input-container {
            display: flex;
            gap: 1rem;
        }
        .chat-input {
            flex: 1;
            padding: 1rem;
            border: 1px solid #8b5cf6;
            border-radius: 25px;
            background: #0f0f23;
            color: white;
            font-family: 'Cairo', sans-serif;
        }
        .chat-input:focus {
            outline: none;
            border-color: #e94560;
        }
        
        /* Modals */
        .modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.9); 
            z-index: 1000; 
            align-items: center; 
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        .modal.active { display: flex; animation: fadeIn 0.3s ease; }
        
        .modal-content { 
            background: linear-gradient(135deg, #16213e 0%, #1a1a3e 100%); 
            padding: 2rem; 
            border-radius: 20px; 
            width: 90%; 
            max-width: 600px;
            border: 2px solid #8b5cf6;
            box-shadow: 0 25px 50px rgba(0,0,0,0.5);
        }
        
        .form-group { margin-bottom: 1.5rem; }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #8b5cf6;
        }
        .form-group input, .form-group textarea { 
            width: 100%; 
            padding: 1rem; 
            border: 1px solid #333; 
            border-radius: 10px; 
            background: #0f0f23; 
            color: white;
            font-family: 'Cairo', sans-serif;
            transition: border-color 0.3s;
        }
        .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: #8b5cf6;
        }
        
        /* File Upload Area */
        .file-upload {
            border: 3px dashed #8b5cf6;
            border-radius: 15px;
            padding: 3rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(139, 92, 246, 0.05);
        }
        .file-upload:hover {
            background: rgba(139, 92, 246, 0.1);
            border-color: #e94560;
        }
        .file-upload i { font-size: 3rem; color: #8b5cf6; margin-bottom: 1rem; }
        .file-upload.dragover {
            background: rgba(233, 69, 96, 0.1);
            border-color: #e94560;
        }
        
        /* Progress Bar */
        .progress-container {
            margin: 1rem 0;
            display: none;
        }
        .progress-bar { 
            width: 100%; 
            height: 25px; 
            background: #333; 
            border-radius: 15px; 
            overflow: hidden;
            border: 1px solid #444;
        }
        .progress-fill { 
            height: 100%; 
            background: linear-gradient(90deg, #8b5cf6, #e94560); 
            width: 0%; 
            transition: width 0.3s; 
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        /* Video Player */
        video { 
            width: 100%; 
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        /* Toast Notification */
        .toast { 
            position: fixed; 
            bottom: 30px; 
            left: 50%; 
            transform: translateX(-50%); 
            background: linear-gradient(135deg, #e94560 0%, #8b5cf6 100%); 
            color: white; 
            padding: 1rem 2rem; 
            border-radius: 50px;
            display: none;
            z-index: 9999;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            font-weight: bold;
        }
        .toast.show { 
            display: block; 
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp {
            from { transform: translateX(-50%) translateY(100px); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }
        
        /* Storage Info */
        .storage-info {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid #10b981;
            border-radius: 15px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .storage-bar {
            flex: 1;
            height: 10px;
            background: #333;
            border-radius: 5px;
            overflow: hidden;
        }
        .storage-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #8b5cf6);
            transition: width 0.3s;
        }
        
        /* Empty State */
        .empty-state { 
            text-align: center; 
            color: #666; 
            margin-top: 4rem;
            padding: 3rem;
        }
        .empty-state i { font-size: 5rem; margin-bottom: 1rem; color: #333; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .navbar { padding: 1rem; }
            .logo { font-size: 1.4rem; }
            .container { padding: 1rem; }
            .videos-grid { grid-template-columns: 1fr; }
            .hero h1 { font-size: 1.8rem; }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #0f0f23; }
        ::-webkit-scrollbar-thumb { background: #8b5cf6; border-radius: 5px; }
        ::-webkit-scrollbar-thumb:hover { background: #e94560; }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p style="margin-top: 1rem; color: #8b5cf6;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø°ÙƒÙŠØ©...</p>
    </div>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="logo">
            <i class="fas fa-robot"></i>
            <span>ÙÙ„Ùƒ Ø§Ù„Ø°ÙƒÙŠ</span>
        </div>
        <div style="display: flex; gap: 0.5rem;">
            <button class="btn btn-secondary" id="aiBtn" onclick="toggleAI()" style="display:none">
                <i class="fas fa-brain"></i> Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
            </button>
            <button class="btn" id="loginBtn" onclick="openModal('authModal')">
                <i class="fas fa-lock"></i> Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±Ù
            </button>
            <button class="btn btn-danger" id="logoutBtn" style="display:none" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Ø®Ø±ÙˆØ¬
            </button>
        </div>
    </nav>

    <div class="container">
        <!-- Hero -->
        <div class="hero">
            <h1><i class="fas fa-star"></i> Ø§ÙƒØªØ´Ù Ø£Ø³Ø±Ø§Ø± Ø§Ù„ÙƒÙˆÙ†</h1>
            <p>Ù…Ù†ØµØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ© Ù…Ø¹ Ù…Ø³Ø§Ø¹Ø¯ AI Ù…ØªÙƒØ§Ù…Ù„</p>
        </div>

        <!-- Storage Info -->
        <div class="storage-info" id="storageInfo" style="display:none">
            <i class="fas fa-database" style="color: #10b981; font-size: 1.5rem;"></i>
            <div style="flex: 1;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span>Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©</span>
                    <span id="storageText">0 MB / 50 MB</span>
                </div>
                <div class="storage-bar">
                    <div class="storage-fill" id="storageFill" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Admin Panel -->
        <div class="admin-panel" id="adminPanel">
            <h2 style="color: #8b5cf6; margin-bottom: 1rem;">
                <i class="fas fa-cog"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            </h2>
            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                <button class="btn btn-secondary" onclick="openModal('uploadModal')">
                    <i class="fas fa-cloud-upload-alt"></i> Ø±ÙØ¹ ÙÙŠØ¯ÙŠÙˆ Ù…Ù† Ø§Ù„Ù…Ø¹Ø±Ø¶
                </button>
                <button class="btn btn-success" onclick="exportData()">
                    <i class="fas fa-download"></i> Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                </button>
                <button class="btn" style="background: #f59e0b;" onclick="importData()">
                    <i class="fas fa-upload"></i> Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø©
                </button>
                <button class="btn btn-danger" onclick="deleteAll()">
                    <i class="fas fa-trash-alt"></i> Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„
                </button>
            </div>
        </div>

        <!-- AI Chat Section -->
        <div class="ai-section" id="aiSection">
            <h2 style="color: #10b981; margin-bottom: 1rem;">
                <i class="fas fa-robot"></i> Ù…Ø³Ø§Ø¹Ø¯ ÙÙ„Ùƒ Ø§Ù„Ø°ÙƒÙŠ
            </h2>
            <div class="chat-container" id="chatContainer">
                <div class="chat-message ai">
                    <i class="fas fa-robot"></i> Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ. ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ:
                    <br>â€¢ Ø´Ø±Ø­ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª
                    <br>â€¢ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„ØªÙƒ Ø§Ù„ÙÙ„ÙƒÙŠØ©
                    <br>â€¢ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª
                </div>
            </div>
            <div class="chat-input-container">
                <input type="text" class="chat-input" id="chatInput" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..." onkeypress="if(event.key==='Enter')sendMessage()">
                <button class="btn btn-success" onclick="sendMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>

        <!-- Videos Grid -->
        <div id="videosContainer" class="videos-grid"></div>
        
        <!-- Empty State -->
        <div class="empty-state" id="emptyState" style="display: none;">
            <i class="fas fa-video-slash"></i>
            <h3 style="color: #666; margin-bottom: 0.5rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</h3>
            <p style="color: #888;">Ù‚Ù… Ø¨Ø±ÙØ¹ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù…Ù† Ø§Ù„Ù…Ø¹Ø±Ø¶ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…ÙƒØªØ¨Ø©</p>
        </div>
    </div>

    <!-- Auth Modal -->
    <div class="modal" id="authModal">
        <div class="modal-content">
            <h2 style="margin-bottom: 1.5rem; color: #e94560;">
                <i class="fas fa-lock"></i> Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±Ù
            </h2>
            <div class="form-group">
                <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                <input type="password" id="adminPass" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±..." style="text-align: center; font-size: 1.2rem;">
            </div>
            <button class="btn" onclick="checkAuth()" style="width: 100%; margin-bottom: 0.5rem;">
                <i class="fas fa-sign-in-alt"></i> Ø¯Ø®ÙˆÙ„
            </button>
            <button onclick="closeModal('authModal')" style="background: transparent; border: none; color: #888; width: 100%; cursor: pointer;">
                Ø¥Ù„ØºØ§Ø¡
            </button>
        </div>
    </div>

    <!-- Upload Modal -->
    <div class="modal" id="uploadModal">
        <div class="modal-content" style="max-width: 700px;">
            <h2 style="margin-bottom: 1.5rem; color: #8b5cf6;">
                <i class="fas fa-cloud-upload-alt"></i> Ø±ÙØ¹ ÙÙŠØ¯ÙŠÙˆ Ø¬Ø¯ÙŠØ¯
            </h2>
            
            <div class="form-group">
                <label>Ø§Ø®ØªØ± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…Ù† Ø§Ù„Ù…Ø¹Ø±Ø¶</label>
                <div class="file-upload" id="dropZone" onclick="document.getElementById('videoFile').click()">
                    <i class="fas fa-film"></i>
                    <p style="font-size: 1.1rem; margin-bottom: 0.5rem;">Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø³Ø­Ø¨ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</p>
                    <p style="color: #888; font-size: 0.9rem;">ÙŠØ¯Ø¹Ù…: MP4, WebM, MOV (Max 50MB)</p>
                    <input type="file" id="videoFile" accept="video/*" style="display: none;" onchange="handleFileSelect(this.files[0])">
                </div>
            </div>

            <div class="progress-container" id="progressContainer">
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span id="progressText">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</span>
                    <span id="progressPercent">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill">0%</div>
                </div>
            </div>

            <div class="form-group">
                <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</label>
                <input type="text" id="videoTitle" placeholder="Ù…Ø«Ø§Ù„: Ø®Ø³ÙˆÙ Ø§Ù„Ù‚Ù…Ø± 2024">
            </div>

            <div class="form-group">
                <label>ÙˆØµÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                <textarea id="videoDesc" rows="3" placeholder="Ø£Ø¶Ù ÙˆØµÙØ§Ù‹ Ù„Ù„ÙÙŠØ¯ÙŠÙˆ..."></textarea>
            </div>

            <div style="display: flex; gap: 1rem;">
                <button class="btn btn-secondary" onclick="uploadVideo()" id="uploadBtn" disabled style="flex: 1;">
                    <i class="fas fa-upload"></i> Ø±ÙØ¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
                </button>
                <button onclick="closeModal('uploadModal')" style="flex: 1; background: #333; border: none; color: white; padding: 1rem; border-radius: 25px; cursor: pointer;">
                    Ø¥Ù„ØºØ§Ø¡
                </button>
            </div>
        </div>
    </div>

    <!-- Player Modal -->
    <div class="modal" id="playerModal">
        <div class="modal-content" style="max-width: 900px;">
            <h2 id="playerTitle" style="margin-bottom: 1rem; color: #ffd700;"></h2>
            <video id="mainPlayer" controls playsinline></video>
            <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                <button onclick="closePlayer()" class="btn" style="flex: 1; background: #666;">
                    <i class="fas fa-times"></i> Ø¥ØºÙ„Ø§Ù‚
                </button>
                <button onclick="askAIAboutVideo()" class="btn btn-success" style="flex: 1;">
                    <i class="fas fa-robot"></i> Ø§Ø³Ø£Ù„ AI Ø¹Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
                </button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
        // ===== CONFIGURATION =====
        const ADMIN_PASSWORD = "falak123";
        const MAX_STORAGE_MB = 50; // Maximum storage in MB
        const DB_NAME = 'FalakDB';
        const DB_VERSION = 1;
        
        // ===== STATE =====
        let isAdmin = false;
        let selectedFile = null;
        let videos = [];
        let currentVideoIndex = null;
        let db = null;
        let chatHistory = [];

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', async () => {
            await initDatabase();
            await loadVideos();
            updateStorageInfo();
            
            // Setup drag and drop
            setupDragDrop();
            
            // Hide loading
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
            }, 1000);
        });

        // ===== DATABASE (IndexedDB) =====
        async function initDatabase() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                
                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    db = request.result;
                    resolve();
                };
                
                request.onupgradeneeded = (event) => {
                    const database = event.target.result;
                    if (!database.objectStoreNames.contains('videos')) {
                        const store = database.createObjectStore('videos', { keyPath: 'id', autoIncrement: true });
                        store.createIndex('createdAt', 'createdAt', { unique: false });
                    }
                };
            });
        }

        // ===== FILE HANDLING =====
        function setupDragDrop() {
            const dropZone = document.getElementById('dropZone');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, () => dropZone.classList.add('dragover'), false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, () => dropZone.classList.remove('dragover'), false);
            });
            
            dropZone.addEventListener('drop', (e) => {
                const files = e.dataTransfer.files;
                if (files.length > 0 && files[0].type.startsWith('video/')) {
                    handleFileSelect(files[0]);
                } else {
                    showToast('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø³Ù‚Ø§Ø· Ù…Ù„Ù ÙÙŠØ¯ÙŠÙˆ ÙÙ‚Ø·');
                }
            }, false);
        }

        function handleFileSelect(file) {
            if (!file.type.startsWith('video/')) {
                showToast('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù ÙÙŠØ¯ÙŠÙˆ ÙÙ‚Ø·');
                return;
            }
            
            if (file.size > MAX_STORAGE_MB * 1024 * 1024) {
                showToast(`âš ï¸ Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹. Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ ${MAX_STORAGE_MB}MB`);
                return;
            }
            
            selectedFile = file;
            document.getElementById('videoTitle').value = file.name.replace(/\.[^/.]+$/, '');
            document.getElementById('uploadBtn').disabled = false;
            
            // Show file info
            const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
            showToast(`âœ… ØªÙ… Ø§Ø®ØªÙŠØ§Ø±: ${file.name} (${sizeMB} MB)`);
        }

        // ===== VIDEO UPLOAD =====
        async function uploadVideo() {
            if (!selectedFile) return;
            
            const title = document.getElementById('videoTitle').value.trim();
            if (!title) {
                showToast('âš ï¸ Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ù„Ù„ÙÙŠØ¯ÙŠÙˆ');
                return;
            }

            const progressContainer = document.getElementById('progressContainer');
            const progressFill = document.getElementById('progressFill');
            const progressPercent = document.getElementById('progressPercent');
            const progressText = document.getElementById('progressText');
            const uploadBtn = document.getElementById('uploadBtn');
            
            progressContainer.style.display = 'block';
            uploadBtn.disabled = true;
            
            try {
                // Check storage limit
                const currentSize = await getTotalStorageSize();
                if (currentSize + selectedFile.size > MAX_STORAGE_MB * 1024 * 1024) {
                    throw new Error('Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ†ÙŠØ© Ù…Ù…ØªÙ„Ø¦Ø©! Ø§Ø­Ø°Ù Ø¨Ø¹Ø¶ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø£ÙˆÙ„Ø§Ù‹');
                }

                // Convert file to ArrayBuffer for storage
                progressText.textContent = 'Ø¬Ø§Ø±ÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù...';
                const arrayBuffer = await readFileAsArrayBuffer(selectedFile);
                
                progressText.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ†...';
                
                // Create video object
                const videoData = {
                    title: title,
                    description: document.getElementById('videoDesc').value.trim(),
                    filename: selectedFile.name,
                    type: selectedFile.type,
                    size: selectedFile.size,
                    data: arrayBuffer,
                    createdAt: new Date().toISOString(),
                    thumbnail: null
                };

                // Generate thumbnail
                progressText.textContent = 'Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…ØµØºØ±Ø©...';
                videoData.thumbnail = await generateThumbnail(arrayBuffer, selectedFile.type);

                // Save to IndexedDB
                progressText.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...';
                
                const transaction = db.transaction(['videos'], 'readwrite');
                const store = transaction.objectStore('videos');
                
                await new Promise((resolve, reject) => {
                    const request = store.add(videoData);
                    request.onsuccess = () => {
                        videoData.id = request.result;
                        resolve();
                    };
                    request.onerror = () => reject(request.error);
                });

                // Update UI
                videos.unshift(videoData);
                renderVideos();
                updateStorageInfo();
                
                showToast('âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ù†Ø¬Ø§Ø­!');
                closeModal('uploadModal');
                resetUploadForm();
                
            } catch (error) {
                console.error('Upload error:', error);
                showToast('âŒ Ø®Ø·Ø£: ' + error.message);
            } finally {
                progressContainer.style.display = 'none';
                uploadBtn.disabled = false;
            }
        }

        function readFileAsArrayBuffer(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = (e) => reject(e);
                reader.readAsArrayBuffer(file);
            });
        }

        async function generateThumbnail(arrayBuffer, mimeType) {
            return new Promise((resolve) => {
                const blob = new Blob([arrayBuffer], { type: mimeType });
                const url = URL.createObjectURL(blob);
                const video = document.createElement('video');
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                video.src = url;
                video.crossOrigin = 'anonymous';
                
                video.onloadeddata = () => {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                    
                    // Resize to thumbnail
                    const thumbCanvas = document.createElement('canvas');
                    thumbCanvas.width = 320;
                    thumbCanvas.height = 180;
                    const thumbCtx = thumbCanvas.getContext('2d');
                    thumbCtx.drawImage(canvas, 0, 0, 320, 180);
                    
                    const thumbnail = thumbCanvas.toDataURL('image/jpeg', 0.7);
                    URL.revokeObjectURL(url);
                    resolve(thumbnail);
                };
                
                video.onerror = () => {
                    URL.revokeObjectURL(url);
                    resolve(null);
                };
            });
        }

        // ===== LOAD VIDEOS =====
        async function loadVideos() {
            try {
                const transaction = db.transaction(['videos'], 'readonly');
                const store = transaction.objectStore('videos');
                const index = store.index('createdAt');
                
                const request = index.openCursor(null, 'prev');
                videos = [];
                
                await new Promise((resolve, reject) => {
                    request.onsuccess = (event) => {
                        const cursor = event.target.result;
                        if (cursor) {
                            videos.push(cursor.value);
                            cursor.continue();
                        } else {
                            resolve();
                        }
                    };
                    request.onerror = () => reject(request.error);
                });
                
                renderVideos();
            } catch (error) {
                console.error('Load error:', error);
                showToast('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª');
            }
        }

        function renderVideos() {
            const container = document.getElementById('videosContainer');
            const emptyState = document.getElementById('emptyState');
            
            if (videos.length === 0) {
                container.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            container.innerHTML = videos.map((v, index) => `
                <div class="video-card" onclick="playVideo(${index})">
                    <div class="video-thumb">
                        ${v.thumbnail ? 
                            `<img src="${v.thumbnail}" alt="${v.title}" loading="lazy">` : 
                            `<i class="fas fa-film" style="font-size: 3rem;"></i>`
                        }
                        <div class="play-icon">
                            <i class="fas fa-play"></i>
                        </div>
                        ${isAdmin ? `
                            <button class="delete-btn" onclick="deleteVideo(${index}, event)" title="Ø­Ø°Ù">
                                <i class="fas fa-trash"></i>
                            </button>
                        ` : ''}
                    </div>
                    <div class="video-info">
                        <h3>${v.title}</h3>
                        <p>${v.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}</p>
                        <span class="video-size">
                            <i class="fas fa-hdd"></i> ${formatBytes(v.size)}
                        </span>
                        <span class="video-size" style="margin-right: 0.5rem;">
                            <i class="fas fa-calendar"></i> ${new Date(v.createdAt).toLocaleDateString('ar-EG')}
                        </span>
                    </div>
                </div>
            `).join('');
        }

        // ===== VIDEO PLAYER =====
        function playVideo(index) {
            const v = videos[index];
            currentVideoIndex = index;
            
            if (!v || !v.data) {
                showToast('âŒ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ØºÙŠØ± Ù…ØªÙˆÙØ±');
                return;
            }
            
            // Create blob URL from ArrayBuffer
            const blob = new Blob([v.data], { type: v.type });
            const url = URL.createObjectURL(blob);
            
            document.getElementById('playerTitle').textContent = v.title;
            const player = document.getElementById('mainPlayer');
            player.src = url;
            
            openModal('playerModal');
            
            // Clean up blob URL when done
            player.onended = () => URL.revokeObjectURL(url);
        }

        function closePlayer() {
            const player = document.getElementById('mainPlayer');
            player.pause();
            if (player.src) {
                URL.revokeObjectURL(player.src);
                player.src = '';
            }
            closeModal('playerModal');
            currentVideoIndex = null;
        }

        // ===== AI CHAT (Local Intelligence) =====
        function toggleAI() {
            const aiSection = document.getElementById('aiSection');
            aiSection.classList.toggle('active');
            
            if (aiSection.classList.contains('active')) {
                document.getElementById('chatInput').focus();
            }
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addChatMessage(message, 'user');
            input.value = '';
            
            // Generate AI response
            setTimeout(() => {
                const response = generateAIResponse(message);
                addChatMessage(response, 'ai');
            }, 500 + Math.random() * 1000); // Simulate thinking
        }

        function addChatMessage(text, sender) {
            const container = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}`;
            
            const icon = sender === 'user' ? '<i class="fas fa-user"></i>' : '<i class="fas fa-robot"></i>';
            messageDiv.innerHTML = `${icon} ${text}`;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
            
            // Save to history
            chatHistory.push({ sender, text, time: new Date() });
        }

        function generateAIResponse(input) {
            const lowerInput = input.toLowerCase();
            
            // Astronomy knowledge base
            const responses = {
                'Ø´Ù…Ø³': 'Ø§Ù„Ø´Ù…Ø³ Ù‡ÙŠ Ù†Ø¬Ù… ÙÙŠ Ù…Ø±ÙƒØ² Ù†Ø¸Ø§Ù…Ù†Ø§ Ø§Ù„Ø´Ù…Ø³ÙŠØŒ ÙŠØ¨Ù„Øº Ù‚Ø·Ø±Ù‡Ø§ 1.4 Ù…Ù„ÙŠÙˆÙ† ÙƒÙ… ÙˆØ¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ø³Ø·Ø­Ù‡Ø§ Ø­ÙˆØ§Ù„ÙŠ 5,500 Ø¯Ø±Ø¬Ø© Ù…Ø¦ÙˆÙŠØ©.',
                'Ù‚Ù…Ø±': 'Ø§Ù„Ù‚Ù…Ø± Ù‡Ùˆ Ø§Ù„Ù‚Ù…Ø± Ø§Ù„ÙˆØ­ÙŠØ¯ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ Ù„Ù„Ø£Ø±Ø¶ØŒ ÙŠØ¨Ø¹Ø¯ Ø¹Ù†Ù‡Ø§ 384,400 ÙƒÙ… ÙˆÙŠØ³ØªØºØ±Ù‚ 27.3 ÙŠÙˆÙ…Ø§Ù‹ Ù„Ù„Ø¯ÙˆØ±Ø§Ù† Ø­ÙˆÙ„Ù‡Ø§.',
                'ÙƒÙˆÙƒØ¨': 'Ù†Ø¸Ø§Ù…Ù†Ø§ Ø§Ù„Ø´Ù…Ø³ÙŠ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ 8 ÙƒÙˆØ§ÙƒØ¨: Ø¹Ø·Ø§Ø±Ø¯ØŒ Ø§Ù„Ø²Ù‡Ø±Ø©ØŒ Ø§Ù„Ø£Ø±Ø¶ØŒ Ø§Ù„Ù…Ø±ÙŠØ®ØŒ Ø§Ù„Ù…Ø´ØªØ±ÙŠØŒ Ø²Ø­Ù„ØŒ Ø£ÙˆØ±Ø§Ù†ÙˆØ³ØŒ Ù†Ø¨ØªÙˆÙ†.',
                'Ù†Ø¬Ù…': 'Ø§Ù„Ù†Ø¬ÙˆÙ… Ù‡ÙŠ Ø£Ø¬Ø³Ø§Ù… Ø³Ù…Ø§ÙˆÙŠØ© Ø¶Ø®Ù…Ø© Ù…Ù† Ø§Ù„ØºØ§Ø² Ø§Ù„Ù…Ù„ØªÙ‡Ø¨ ØªÙ†ØªØ¬ Ø§Ù„Ø¶ÙˆØ¡ ÙˆØ§Ù„Ø­Ø±Ø§Ø±Ø© Ø¨ÙØ¶Ù„ Ø§Ù„Ø§Ù†Ø¯Ù…Ø§Ø¬ Ø§Ù„Ù†ÙˆÙˆÙŠ.',
                'Ù…Ø¬Ø±Ø©': 'Ù…Ø¬Ø±Ø© Ø¯Ø±Ø¨ Ø§Ù„ØªØ¨Ø§Ù†Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ 100-400 Ù…Ù„ÙŠØ§Ø± Ù†Ø¬Ù…ØŒ ÙˆÙŠØ¨Ù„Øº Ù‚Ø·Ø±Ù‡Ø§ 100,000 Ø³Ù†Ø© Ø¶ÙˆØ¦ÙŠØ©.',
                'ÙÙŠØ¯ÙŠÙˆ': currentVideoIndex !== null ? 
                    `Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø­Ø§Ù„ÙŠ "${videos[currentVideoIndex]?.title}" ÙŠØªØ­Ø¯Ø« Ø¹Ù† ${videos[currentVideoIndex]?.description || 'Ù…ÙˆØ¶ÙˆØ¹ ÙÙ„ÙƒÙŠ Ù…Ø«ÙŠØ± Ù„Ù„Ø§Ù‡ØªÙ…Ø§Ù…'}.` : 
                    'ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ ÙÙŠØ¯ÙŠÙˆ Ù…Ù† Ø§Ù„Ù…ÙƒØªØ¨Ø© ÙˆØ³Ø£Ø³Ø§Ø¹Ø¯Ùƒ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ù…Ø­ØªÙˆØ§Ù‡!',
                'Ø®Ø³ÙˆÙ': 'Ø§Ù„Ø®Ø³ÙˆÙ ÙŠØ­Ø¯Ø« Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙ…Ø± Ø§Ù„Ù‚Ù…Ø± ÙÙŠ Ø¸Ù„ Ø§Ù„Ø£Ø±Ø¶ØŒ Ø¨ÙŠÙ†Ù…Ø§ Ø§Ù„ÙƒØ³ÙˆÙ ÙŠØ­Ø¯Ø« Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙ…Ø± Ø§Ù„Ù‚Ù…Ø± Ø¨ÙŠÙ† Ø§Ù„Ø´Ù…Ø³ ÙˆØ§Ù„Ø£Ø±Ø¶.',
                'ÙØ¶Ø§Ø¡': 'Ø§Ù„ÙØ¶Ø§Ø¡ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ Ù‡Ùˆ Ø§Ù„ÙØ±Ø§Øº Ø¨ÙŠÙ† Ø§Ù„Ø£Ø¬Ø±Ø§Ù… Ø§Ù„Ø³Ù…Ø§ÙˆÙŠØ©ØŒ ÙŠÙ…ØªÙ„Ø¦ Ø¨Ø§Ù„ØºØ¨Ø§Ø± Ø§Ù„ÙƒÙˆÙ†ÙŠ ÙˆØ§Ù„Ø¥Ø´Ø¹Ø§Ø¹ ÙˆØ§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø¸Ù„Ù…Ø©.',
                'ØµØ§Ø±ÙˆØ®': 'Ø§Ù„ØµÙˆØ§Ø±ÙŠØ® ØªØ¹Ù…Ù„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù‚Ø§Ù†ÙˆÙ† Ù†ÙŠÙˆØªÙ† Ø§Ù„Ø«Ø§Ù„Ø«: Ù„ÙƒÙ„ ÙØ¹Ù„ Ø±Ø¯ ÙØ¹Ù„ Ù…Ø³Ø§ÙˆÙ Ù„Ù‡ ÙÙŠ Ø§Ù„Ù…Ù‚Ø¯Ø§Ø± ÙˆÙ…Ø¹Ø§ÙƒØ³ Ù„Ù‡ ÙÙŠ Ø§Ù„Ø§ØªØ¬Ø§Ù‡.',
                'Ù…Ø±ÙŠØ®': 'Ø§Ù„Ù…Ø±ÙŠØ® Ù‡Ùˆ Ø§Ù„ÙƒÙˆÙƒØ¨ Ø§Ù„Ø£Ø­Ù…Ø±ØŒ ÙŠØ¨Ø¹Ø¯ 227 Ù…Ù„ÙŠÙˆÙ† ÙƒÙ… Ø¹Ù† Ø§Ù„Ø´Ù…Ø³ ÙˆÙŠÙˆÙ…Ù‡ ÙŠØ³ØªØºØ±Ù‚ 24.6 Ø³Ø§Ø¹Ø©.',
                'Ø²Ø­Ù„': 'Ø²Ø­Ù„ Ù…Ø´Ù‡ÙˆØ± Ø¨Ø­Ù„Ù‚Ø§ØªÙ‡ Ø§Ù„Ø¬Ù…ÙŠÙ„Ø© Ø§Ù„ØªÙŠ ØªØªÙƒÙˆÙ† Ù…Ù† Ø¬Ø²ÙŠØ¦Ø§Øª Ø§Ù„Ø¬Ù„ÙŠØ¯ ÙˆØ§Ù„ØµØ®ÙˆØ±ØŒ ÙˆÙŠØ¨Ù„Øº Ø¹Ø¯Ø¯ Ø£Ù‚Ù…Ø§Ø±Ù‡ 146 Ù‚Ù…Ø±Ø§Ù‹ Ù…Ø¹Ø±ÙˆÙØ§Ù‹!',
                'Ù…Ø´ØªØ±ÙŠ': 'Ø§Ù„Ù…Ø´ØªØ±ÙŠ Ù‡Ùˆ Ø£ÙƒØ¨Ø± ÙƒÙˆØ§ÙƒØ¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø´Ù…Ø³ÙŠØ©ØŒ ÙŠØ¨Ù„Øº Ù‚Ø·Ø±Ù‡ 11 Ø¶Ø¹Ù Ù‚Ø·Ø± Ø§Ù„Ø£Ø±Ø¶ØŒ ÙˆÙ„Ù‡ 95 Ù‚Ù…Ø±Ø§Ù‹ Ù…Ø¹Ø±ÙˆÙØ§Ù‹.',
                'Ø«Ù‚Ø¨ Ø£Ø³ÙˆØ¯': 'Ø§Ù„Ø«Ù‚Ø¨ Ø§Ù„Ø£Ø³ÙˆØ¯ Ù‡Ùˆ Ù…Ù†Ø·Ù‚Ø© ÙÙŠ Ø§Ù„ÙØ¶Ø§Ø¡ Ø­ÙŠØ« Ø§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ© Ù‚ÙˆÙŠØ© Ø¬Ø¯Ø§Ù‹ Ù„Ø¯Ø±Ø¬Ø© Ø£Ù† Ø§Ù„Ø¶ÙˆØ¡ Ù„Ø§ ÙŠØ³ØªØ·ÙŠØ¹ Ø§Ù„Ù‡Ø±ÙˆØ¨ Ù…Ù†Ù‡Ø§!',
                'default': 'Ø³Ø¤Ø§Ù„ Ù…Ø«ÙŠØ± Ù„Ù„Ø§Ù‡ØªÙ…Ø§Ù…! ğŸŒŸ ÙÙŠ Ø¹Ù„Ù… Ø§Ù„ÙÙ„ÙƒØŒ Ù‡Ù†Ø§Ùƒ Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø£Ø³Ø±Ø§Ø± Ø¬Ø¯ÙŠØ¯Ø© ØªÙ†ØªØ¸Ø± Ø§Ù„Ø§ÙƒØªØ´Ø§Ù. ÙŠÙ…ÙƒÙ†Ùƒ Ø³Ø¤Ø§Ù„ÙŠ Ø¹Ù† Ø§Ù„Ø´Ù…Ø³ØŒ Ø§Ù„Ù‚Ù…Ø±ØŒ Ø§Ù„ÙƒÙˆØ§ÙƒØ¨ØŒ Ø§Ù„Ù†Ø¬ÙˆÙ…ØŒ Ø£Ùˆ Ø§Ù„Ù…Ø¬Ø±Ø§Øª!'
            };
            
            // Check for keywords
            for (let [key, response] of Object.entries(responses)) {
                if (lowerInput.includes(key)) {
                    return response;
                }
            }
            
            // Context-aware responses
            if (lowerInput.includes('Ù…Ø±Ø­Ø¨Ø§') || lowerInput.includes('Ø§Ù‡Ù„Ø§')) {
                return 'Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ! ğŸŒ™ Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯ ÙÙ„Ùƒ Ø§Ù„Ø°ÙƒÙŠ. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„ÙƒÙˆÙ† Ø§Ù„ÙŠÙˆÙ…ØŸ';
            }
            if (lowerInput.includes('Ø´ÙƒØ±Ø§') || lowerInput.includes('Ø´ÙƒØ±Ø§Ù‹')) {
                return 'Ø§Ù„Ø¹ÙÙˆ! ğŸš€ Ø§Ø³ØªÙ…ØªØ¹ Ø¨Ø§Ø³ØªÙƒØ´Ø§Ù Ø£Ø³Ø±Ø§Ø± Ø§Ù„ÙƒÙˆÙ†. Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø³Ø¤Ø§Ù„ Ø¢Ø®Ø±ØŸ';
            }
            if (lowerInput.includes('Ø­Ø°Ù') || lowerInput.includes('Ù…Ø³Ø­')) {
                return 'âš ï¸ Ù„Ø­Ø°Ù ÙÙŠØ¯ÙŠÙˆØŒ ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù…Ø´Ø±ÙØ§Ù‹. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±Ù" ÙˆØ£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±.';
            }
            
            return responses.default;
        }

        function askAIAboutVideo() {
            closePlayer();
            const aiSection = document.getElementById('aiSection');
            aiSection.classList.add('active');
            
            if (currentVideoIndex !== null) {
                const video = videos[currentVideoIndex];
                setTimeout(() => {
                    addChatMessage(`Ø£Ø±ÙŠØ¯ Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ Ø¹Ù† ÙÙŠØ¯ÙŠÙˆ "${video.title}"`, 'user');
                    setTimeout(() => {
                        addChatMessage(generateAIResponse('ÙÙŠØ¯ÙŠÙˆ'), 'ai');
                    }, 800);
                }, 300);
            }
            
            document.getElementById('chatInput').focus();
        }

        // ===== STORAGE MANAGEMENT =====
        async function getTotalStorageSize() {
            let total = 0;
            videos.forEach(v => total += v.size);
            return total;
        }

        async function updateStorageInfo() {
            const totalBytes = await getTotalStorageSize();
            const totalMB = (totalBytes / (1024 * 1024)).toFixed(1);
            const percent = Math.min((totalMB / MAX_STORAGE_MB) * 100, 100);
            
            document.getElementById('storageText').textContent = `${totalMB} MB / ${MAX_STORAGE_MB} MB`;
            document.getElementById('storageFill').style.width = `${percent}%`;
            document.getElementById('storageInfo').style.display = isAdmin ? 'flex' : 'none';
        }

        function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }

        // ===== DELETE OPERATIONS =====
        async function deleteVideo(index, event) {
            if (event) event.stopPropagation();
            if (!confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ÙÙŠØ¯ÙŠÙˆØŸ')) return;
            
            try {
                const v = videos[index];
                const transaction = db.transaction(['videos'], 'readwrite');
                const store = transaction.objectStore('videos');
                
                await new Promise((resolve, reject) => {
                    const request = store.delete(v.id);
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
                
                videos.splice(index, 1);
                renderVideos();
                updateStorageInfo();
                showToast('ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ');
            } catch (error) {
                console.error('Delete error:', error);
                showToast('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù');
            }
        }

        async function deleteAll() {
            if (!confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ALL Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§ØªØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹!')) return;
            if (!confirm('âš ï¸ ØªØ£ÙƒÙŠØ¯ Ù†Ù‡Ø§Ø¦ÙŠ: Ø³ÙŠØªÙ… Ø­Ø°Ù ÙƒÙ„ Ø´ÙŠØ¡!')) return;
            
            try {
                const transaction = db.transaction(['videos'], 'readwrite');
                const store = transaction.objectStore('videos');
                
                await new Promise((resolve, reject) => {
                    const request = store.clear();
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
                
                videos = [];
                renderVideos();
                updateStorageInfo();
                showToast('ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª');
            } catch (error) {
                showToast('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù');
            }
        }

        // ===== BACKUP & RESTORE =====
        async function exportData() {
            try {
                const data = {
                    videos: videos.map(v => ({
                        ...v,
                        data: Array.from(new Uint8Array(v.data)) // Convert ArrayBuffer to array
                    })),
                    exportDate: new Date().toISOString(),
                    version: '1.0'
                };
                
                const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `falak_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showToast('ğŸ’¾ ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©');
            } catch (error) {
                showToast('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±');
            }
        }

        async function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                try {
                    const text = await file.text();
                    const data = JSON.parse(text);
                    
                    if (!confirm(`Ø§Ø³ØªØ¹Ø§Ø¯Ø© ${data.videos?.length || 0} ÙÙŠØ¯ÙŠÙˆØŸ Ø³ÙŠØªÙ… Ø¯Ù…Ø¬Ù‡Ø§ Ù…Ø¹ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©.`)) return;
                    
                    for (const video of data.videos) {
                        // Convert array back to ArrayBuffer
                        video.data = new Uint8Array(video.data).buffer;
                        
                        // Check storage
                        const currentSize = await getTotalStorageSize();
                        if (currentSize + video.size > MAX_STORAGE_MB * 1024 * 1024) {
                            showToast('âš ï¸ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ù…Ù…ØªÙ„Ø¦Ø©ØŒ ØªÙˆÙ‚Ù Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯');
                            break;
                        }
                        
                        // Add to DB
                        const transaction = db.transaction(['videos'], 'readwrite');
                        const store = transaction.objectStore('videos');
                        
                        // Remove id to let auto-increment work
                        delete video.id;
                        video.createdAt = new Date().toISOString();
                        
                        await new Promise((resolve, reject) => {
                            const request = store.add(video);
                            request.onsuccess = () => resolve();
                            request.onerror = () => reject(request.error);
                        });
                    }
                    
                    await loadVideos();
                    updateStorageInfo();
                    showToast('âœ… ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©');
                } catch (error) {
                    console.error('Import error:', error);
                    showToast('âŒ Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­ Ø£Ùˆ ØªØ§Ù„Ù');
                }
            };
            
            input.click();
        }

        // ===== AUTHENTICATION =====
        function checkAuth() {
            const pass = document.getElementById('adminPass').value;
            
            if (pass === ADMIN_PASSWORD) {
                isAdmin = true;
                document.getElementById('adminPanel').classList.add('active');
                document.getElementById('aiSection').classList.add('active');
                document.getElementById('aiBtn').style.display = 'inline-block';
                document.getElementById('loginBtn').style.display = 'none';
                document.getElementById('logoutBtn').style.display = 'inline-block';
                document.getElementById('storageInfo').style.display = 'flex';
                
                closeModal('authModal');
                renderVideos(); // Re-render to show delete buttons
                showToast('ğŸ”“ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ù…Ø´Ø±Ù! Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø°ÙƒÙŠ Ù…ÙØ¹Ù„');
                
                // Clear password
                document.getElementById('adminPass').value = '';
            } else {
                showToast('âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
                // Shake animation
                const modal = document.querySelector('.modal-content');
                modal.style.animation = 'shake 0.5s';
                setTimeout(() => modal.style.animation = '', 500);
            }
        }

        function logout() {
            isAdmin = false;
            document.getElementById('adminPanel').classList.remove('active');
            document.getElementById('aiSection').classList.remove('active');
            document.getElementById('aiBtn').style.display = 'none';
            document.getElementById('loginBtn').style.display = 'inline-block';
            document.getElementById('logoutBtn').style.display = 'none';
            document.getElementById('storageInfo').style.display = 'none';
            
            renderVideos(); // Re-render to hide delete buttons
            showToast('ğŸ‘‹ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬');
        }

        // ===== UI UTILITIES =====
        function openModal(id) {
            document.getElementById(id).classList.add('active');
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        function resetUploadForm() {
            selectedFile = null;
            document.getElementById('videoTitle').value = '';
            document.getElementById('videoDesc').value = '';
            document.getElementById('uploadBtn').disabled = true;
            document.getElementById('progressContainer').style.display = 'none';
            document.getElementById('progressFill').style.width = '0%';
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Close modals on outside click
        window.onclick = (e) => {
            if (e.target.classList.contains('modal')) {
                if (e.target.id === 'playerModal') closePlayer();
                else closeModal(e.target.id);
            }
        };

        // Add shake animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-10px); }
                75% { transform: translateX(10px); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
